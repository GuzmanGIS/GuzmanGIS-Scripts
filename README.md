# GuzmanGIS-Scripts

**Authors: Emily Segroves & Arturo Guzman**

Last Revised: 11 January 2024

This javascript library can be used with any user interface to manage the creation and management of geoJSON data. 

A key feature of this library is layer management. Layers are handled as properties on each feature within the geoJSON that is generated by this library. When importing GeoJSON using the library, features are split into an array of layers (layer_list).

Key functionalities provided by the library: 

**rename_layer(index, new_layer_name)**

arguments required: index of the layer within layer_list that you wish to rename, new layer name 

This will rename the layer on the layer index and also iterate through all the features in the layer to ensure that their property data is also updated. This is necessary so that when the GeoJSON is downloaded, the layer data is retained correctly. 

**create_layer(name)**

aruments required: name of new layer to be created

This appends the new layer created to the end of the layer_list with the name provided.

**delete_layer(index)**

arguments required: index of the layer within the layer_list to be deleted

This will delete the layer from the layer_list. It also calls the functions to renumber layers (which ensures that the properties of each feature are updated for correct export to geoJSON format) and recalculates the minimum and maximum bounds of the map. 

**renumber_layer_on_properties()**

arguments required: none

This renumbers the layers within the properites of each feature to ensure that the data exported to geoJSON is correct. This should be called whenever the index values of a layer within the layer_list change (for example, when deleting a layer)

**calculate_min_max(x,y)**

arguments required: new x coordinate value and new y coordinate value which should be compared to existing data

The minimum and maximum bounds of the data points are stored in the following variables: max_x_value, min_x_value, max_y_value, and min_y_value. These can be leveraged by the user interface to ensure that the data is displayed correctly to users. This function takes in a new x and y value which are then compared to the existing variable values to determine whether the minimum and maximum bounds of the data have changed. 

**recalculate_min_max()**

arguments required: none

This iterates through all coordinate values in all features to recalculate the minimum and maximum bounds of the data. This is less performant than the calculate_min_max function due to the mass of data handled and the use of nested for loops, and should therefore only be called when calculate_min_max cannot be used.

**set_coordinates(x, y, z)**

arguments required: current x, y, and z coordinates

This sets the global variables that store the x, y, and z values. This should be called prior to creating data points (such as create_point, create_line, and create_polygon) to ensure that the data is created at the correct coordinate values. 

**create_gps_point(layer_index, color, label, description z=0)**

arguments required: index of the layer the point should be created on, color value of the point, label, description, and an optional z index

This async function accesses the Geolocation API to retrieve the user's current location, creates a point at that location with the data provided to the function, and returns the values of the newly created point. Note that if a color, label, or description are not desired, empty strings should be passed. 

**create_point(layer_index, color, label, description)**

arguments required: index of the layer the point should be created on, color value of the point, label, and description

set_coordinates should be called first to ensure that the point is created with the correct x, y, and z values. This creates a point at the current values for x, y and z with the data provided in the arguments. Note that if no color, label, or description is desired, empty strings shoul be passed. 

**select_edit_point(layer_index)**

arguments required: index of the layer to be queried

set_coordinates should be called prior to calling this function. This references the global x, y and z values set. This will iterate through all of the points in the target layer to determine which is closest to the current x and y values provided that the current values are within the SELECTION_RANGE. A global variable SELECTION_RANGE is referenced here which will affect the maximum area considered when returning a match from this function. The function returns the index of the point within the points_list of the layer indicated. 

**update_point_coordinates(layer_index, point_index)**

arguments required: index of the target layer, index of the target point within the points list for that layer. 

set_coordinates should be called prior to calling this function. This references the global x, y, and z values set. This will update the coordinate values of the target point to the current x, y, and z global varibale values. 

**delete_point(layer_index, point_index)**

arguments required: index of the target layer, index of the target point within the points list for that layer. 

This deletes the point at the target layer and point index. 

**create_gps_line(layer_index, color, label, description z=0)**

arguments required: index of the layer the line should be created on, color value of the line, label, description, and an optional z index

This async function accesses the Geolocation API to retrieve the user's current location, creates a line at that location with the data provided to the function, and returns the values of the newly created line. Note that if a color, label, or description are not desired, empty strings should be passed. Also note that this will create a single data point within a line. So an existing in progress line has not been completed, this will continue that line. 

**create_line(layer_index, color, label, description)**

arguments required: index of the layer the line should be created on, color of the line, label, and description

set_coordinates should be called first to ensure that the line is created with the correct x, y, and z values. If the global variable line_start is true, a new line is created with the color, label, and description data passed through. The x, y, and z values passed will the the first coordinates within the line. If line_start is false, the current x, y, and z values are used to create the subsequent points within the line, and the values for color, label, and description are ignored. 

**end_line()**

arguments required: none

This sets the value of line_start to true, thereby ending the existing in-progress lines so that the next time create_line or gps_create_line is called, a new line is created. 

**select_edit_line(layer_index)**

arguments required: index of the layer to be queried

set_coordinates should be called prior to calling this function. This references the global x, y and z values set. This will iterate through all of the points within each line in the target layer to determine which is closest to the current x and y values provided that the current values are within the SELECTION_RANGE. A global variable SELECTION_RANGE is referenced here which will affect the maximum area considered when returning a match from this function. The function returns an object with values line (stores the index of the line within the lines_list of the target layer) and point (stores the index of the point within the array of line coordinates)

**update_line_coordinates(layer_index, line_index)**

arguments required: index of layer within layer list to target, line_index (this should be an object as returned by select_edit_line) which contains the index of the line and the point within the line which should be updated

set_coordinates should be called prior to calling this function. The coordinate within the line on the indicated layer will be updated to the current x, y, and z global values. 

**delete_line_point(layer_index, lines_index)**

arguments required: index of layer within layer list to target, line_index (this should be an object as returned by select_edit_line) which contains the index of the line and the point within the line which should be updated

This deletes the coordinates from the line at the index indicated

**delete_line(layer_index, lines_index)**

arguments required: index of the target layer, line_index (this should be an object as returned by select_edit_line) which contains the index of the line and the point within the line which should be updated

This deletes the entire line at the index indicated on the layer indicated

**create_gps_polygon(layer_index, color, label, description, z=0)**

arguments required: index of the layer the polygon should be created on, color value of the line, label, description, and an optional z index

This async function accesses the Geolocation API to retrieve the user's current location, creates a polygon at that location with the data provided to the function, and returns the values of the newly created polygon. Note that if a color, label, or description are not desired, empty strings should be passed. Also note that this will create a single data point within a polygon. So if an existing in progress polygon has not been completed, this will continue that polygon. 

**create_polygon(layer_index, color, label, description, use_gps_selection)**

arguments required: index of layer the polygon should be created on, color value of the polygon, label, description, and boolean value indicating whether this should reference the GPS_SELECTION_RANGE. 

set_coordinates should be called prior to calling this function, as it references the global x, y, and z variables. 

If polygon_start is true, a new polygon is created at the indicated layer using the color and label data passed to the function. The x, y, and z values will create the first point within the polygon. 

If polygon_start is false, the location of the current x, y, and z values is analyzed. If use_gps_selection is false, the SELECTION_RANGE value is used to determine whether the current coordinates are close enough to the first coordinates in the polygon to warrant completion. If use_gps_selectin is true, the GPS_SELECTION_RANGE value is used. If the current coordinates *are* close enough, then coordinates are added to the polygon which are the same values as the first coordinates, and polygon_start is set to true. If not, then the current coordinates are added to the polygon coordinates list, and the values for color, label, and description are ignored. 

**auto_close_polygon(layer_index)**

arguments required: index of the target layer for auto-completion. 

If polygon_start is false (which indicates that a polygon is in progress), then polygon_start is set to true and a coordinate is pushed to the list of coordinates for the last polygon within the polygon_list on the indicated layer which is the same as the values of the first coordinate for that polygon. 

If polygon_start is true (which indicates taht there is no in progress polygon), then an error is returned. 

**select_edit_polygon(layer_index)**

arguments required: index of the layer to be queried

set_coordinates should be called prior to calling this function. This references the global x, y and z values set. This will iterate through all of the points within each polygon in the target layer to determine which is closest to the current x and y values provided that the current values are within the SELECTION_RANGE. A global variable SELECTION_RANGE is referenced here which will affect the maximum area considered when returning a match from this function. The function returns an object with values polygon (stores the index of the line within the polygons_list of the target layer) and point (stores the index of the point within the array of polygon coordinates)

**update_polygon_coordinates(layer_index, polygon_index)**

arguments required: index of the target layer, polygon_index (this should be an object as returned by select_edit_polygon) which contains the index of the polgyon and the point within the polygon which should be updated

set_coordinates should be called prior to calling this function. The coordinate within the polygon on the indicated layer will be updated to the current x, y, and z global values. 

**delete_polygon(layer_index, polgyon_index)**

arguments required: index of the target layer, polygon_index (this should be an object as returned by select_edit_polygon) which contains the index of the polgyon and the point within the polygon which should be deleted. 

This deletes the polygon at the index indicated.


**delete_polygon_point(layer_index, polgyon_index)**

arguments required: index of the target layer, polygon_index (this should be an object as returned by select_edit_polygon) which contains the index of the polgyon and the point within the polygon which should be deleted. 

This deletes the coordinate within the polygon at the index indicated.

**initialize_gis_project_from_file(features)**

arguments required: geoJSON formatted list of features. Note that GeoJSON format will contain: 

"type": "FeatureCollection",
"features": []

This function expects to recieve the list of features objects. 

This iterates through the list of features to populate the layers_list with the appropriate data. note that if no layer data is provided, all features will be added to a default layer. If layer data was provided within the features list (as properties against each feature), then the layers will be populated accordingly. Returns an error if the data is incorrectly formated and cannot be processed correctly. 

**generate_geoJSON**

arguments required: none

This processes the current layer_list data into geoJSON format and returns a JSON string. 